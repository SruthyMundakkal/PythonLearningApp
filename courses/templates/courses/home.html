{% extends 'courses/base.html' %}

{% block title %}Home - Python Learning App{% endblock %}

{% block content %}
<div class="row" style="display: flex; flex-wrap: wrap;">

    <!-- Left Column: Lessons and Quiz (25% width) -->
    <div class="col s12 m3" style="flex: 1 1 25%; padding-right: 10px; background-color: #f4f4f4; overflow-y: auto; padding: 20px; box-sizing: border-box;">
        <!-- Sidebar Content -->
        <h5>Python Lessons</h5>
        <ul id="lesson-list" class="collection">
            {% for lesson in lessons %}
                <li class="collection-item">
                    <a href="#" data-id="{{ lesson.id }}">{{ lesson.title }}</a>
                    <ul class="topics" id="topics-{{ lesson.id }}" style="display: none; margin-left: 20px;">
                        {% for topic in lesson.topics.all %}
                            <li class="collection-item">
                                <a href="#" data-topic-id="{{ topic.id }}">{{ topic.title }}</a>
                            </li>
                        {% endfor %}
                    </ul>
                </li>
            {% endfor %}
        </ul>

        <!-- Quiz Section -->
        <h5>Take a Quiz</h5>
        <a href="{% url 'quiz' %}" class="btn">Take All Quizzes</a>
    </div>

    <!-- Right Column: Lesson Detail (75% width) -->
    <div class="col s12 m9" id="lesson-detail" style="flex: 1 1 75%; padding-left: 40px; padding-top: 20px; box-sizing: border-box;">
        <h5>What is Python?</h5>
        <p>
            Python is a popular programming language. It was created by Guido van Rossum, and released in 1991.</br></br>
            It is used for:

            <ol>
                <li>web development (server-side),</li>
                <li>software development,</li>
                <li>mathematics,</li>
                <li>system scripting.</li>
            </ol>
        </p>

        <h6>Example</h6>
        <pre style="background-color:#f4f4f4; padding: 1rem; border-left: 4px solid #2196f3; border-radius: 5px;">
            <code>print("Hello, World!")</code>
        </pre>
    </div>
</div>

<script>
    document.querySelectorAll('a[data-id]').forEach(link => {
        link.addEventListener('click', function (event) {
            event.preventDefault();
            const lessonId = this.dataset.id;
            const topicList = document.getElementById(`topics-${lessonId}`);

            document.querySelectorAll('.topics').forEach(el => {
                el.style.display = "none";
            });

            topicList.style.display = (topicList.style.display === "block") ? "none" : "block";
        });
    });

    document.getElementById("lesson-list").addEventListener("click", function (event) {
        if (event.target.tagName.toLowerCase() === 'a' && event.target.hasAttribute('data-topic-id')) {
            const topicId = event.target.getAttribute("data-topic-id");

            fetch(`/topic/${topicId}/details/`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Network response was not ok");
                    }
                    return response.text(); // Get full HTML
                })
                .then(html => {
                    const lessonDetail = document.getElementById("lesson-detail");
                    lessonDetail.innerHTML = html; // Replace right panel with topic detail HTML
                })
                .catch(error => {
                    console.error('Error fetching topic details:', error);
                });
        }
    });
</script>

{% endblock %}
