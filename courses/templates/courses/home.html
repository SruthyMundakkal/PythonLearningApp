{% extends 'courses/base.html' %}

{% block title %}Home - Python Learning App{% endblock %}

{% block content %}
<div class="row">
    <!-- Left Column: Lessons and Quiz -->
    <div class="col s12 m6">
        <h5>Python Lessons</h5>
        <ul id="lesson-list">
            {% for lesson in lessons %}
                <li>
                    <a href="#" data-id="{{ lesson.id }}">{{ lesson.title }}</a>
                    <ul class="topics" id="topics-{{ lesson.id }}" style="display: none; margin-left: 20px;"></ul>
                </li>
            {% endfor %}
        </ul>

        <!-- Your template is mostly good â€” no changes needed except that now topics will load -->
        <!-- Quiz Section -->
        <h5>Take a Quiz</h5>
        <a href="{% url 'quiz' %}" class="btn">Take All Quizzes</a>
    </div>

    <!-- Right Column: Lesson Detail -->
    <div class="col s12 m6" id="lesson-detail">
        <h5>What is Python?</h5>

        <p>
            Python is a popular programming language. It was created by Guido van Rossum, and released in 1991.</br></br>
            It is used for:

            <ol>
                <li>web development (server-side),</li>
                <li>software development,</li>
                <li>mathematics,</li>
                <li>system scripting.</li>
            </ol>
        </p>

        <h6>Example</h6>
        <pre style="background-color:#f4f4f4; padding: 1rem; border-left: 4px solid #2196f3; border-radius: 5px;">
            <code>print("Hello, World!")</code>
        </pre>

    </div>
</div>

<script>
    document.querySelectorAll('a[data-id]').forEach(link => {
        link.addEventListener('click', function(event) {
            event.preventDefault();
            const lessonId = this.dataset.id;
            const topicList = document.getElementById(`topics-${lessonId}`);

            // Toggle visibility
            if (topicList.style.display === "block") {
                topicList.style.display = "none";
                topicList.innerHTML = "";
                return;
            }

            // Collapse all other topic lists
            document.querySelectorAll('.topics').forEach(el => {
                el.style.display = "none";
                el.innerHTML = "";
            });

            fetch(`/lesson/${lessonId}/topics/`)  // Adjust this URL to your Django view
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Network response was not ok");
                    }
                    return response.json(); // Make sure your view returns JSON
                })
                .then(data => {
                    topicList.innerHTML = "";
                    data.forEach(topic => {
                        const li = document.createElement('li');
                        li.textContent = topic.title;
                        topicList.appendChild(li);
                    });
                    topicList.style.display = "block";
                })
                .catch(error => console.error('Error fetching topics:', error));
        });
    });
</script>

{% endblock %}
